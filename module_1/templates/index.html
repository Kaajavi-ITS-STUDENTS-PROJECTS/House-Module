{% extends 'base.html' %}
{% load static %}
{% block titulo %}
<title>Inicio</title>
{% endblock %}
{% block content %}
<div class="row">
    {% include "habitaciones.html" %}
    <div class="col s10 m3 offset-m1">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text center">
                <span class="card-title">Mas</span>
                <br>

                {% for alarma in alarmas %}
                {% if alarma.status %}
                <a href="{% url 'module_1:alarma' alarma.id %}" class="card-panel green  darken-4 waves-effect waves-orange btn-large col s12">Desactivar {{alarma.nombre}} </a>
                {% else %}
                <a href="{% url 'module_1:alarma' alarma.id %}" class="card-panel red  darken-4 waves-effect waves-orange btn-large col s12">Activar {{alarma.nombre}} </a>

                {% endif %}
                {% endfor %}
                <br>

                <a href="" class="card-panel green  darken-4 waves-effect waves-orange btn-large col s12">Mapa</a>




            </div>
            <a class="btn" onclick="hola()">mensaje por el canal</a>
        </div>
    </div>
</div>

 <a class="waves-effect waves-light btn modal-trigger" href="#modal1">Modal</a>

  <!-- Modal Structure -->
  <div id="modal1" class="modal">
    <div class="modal-content">
      <h4>Modal Header</h4>
      <p>A bunch of text</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>

{% endblock %}
{% block scripts %}
<script type="text/javascript" src="{% static 'omnibus/omnibus.min.js' %}"></script>
<script type="text/javascript" src="{% static 'omnibus/sockjs.min.js' %}"></script>
<script type="text/javascript" src="{% static 'omnibus/json2.min.js' %}"></script>

<script>
    function hola(){
        // Select a transport implementation:
        var transport = SockJS; // SockJS can be used alternatively

        // Receive the path for the connection from the django template context:
        var endpoint = 'http://192.168.2.254:8000';

        var options = {
            // Get the omnibus authentication token:
            authToken: '{{ OMNIBUS_AUTH_TOKEN }}'
        };
        // Create a new connection using transport, endpoint and options
        var connection = new Omnibus(transport, endpoint, options);

        var foo = connection.openChannel('foo');

        foo.send('bar');
        console.log("holar");
        foo.on('bar', function(event) {
            console.log("hola");
            connection.closeChannel('foo');
        });
    }

    function habitacion(habitacion_id){
        var data={
            csrfmiddlewaretoken: '{{ csrf_token }}',
            id:habitacion_id,
        }
        $.ajax({
            method: "POST",
            url: "{% url 'module_1:habitacion' %}",
            data: data,
            success:function(result){
                $('#habitaciones').html(result);
            },
            error: function(e){
                console.log(e.responseText);
            }
        });
    }
    function luz(luz_id){
        console.log("a")
        var data={
            csrfmiddlewaretoken: '{{ csrf_token }}',
            id:luz_id,
        }
        $.ajax({
            method: "POST",
            url: "{% url 'module_1:luz' %}",
            data: data,
            success:function(result){
                console.log(result);
                $("#luz-"+luz_id).html(result);
            },
            error: function(e){
                console.log(e.responseText);
            }
        });
    }
    function puerta(puerta_id){
        var data={
            csrfmiddlewaretoken: '{{ csrf_token }}',
            id:puerta_id,
        }
        $.ajax({
            method: "POST",
            url: "{% url 'module_1:puerta' %}",
            data: data,
            success:function(result){
                console.log(result);
                $("#puerta-"+puerta_id).html(result);
            },
            error: function(e){
                console.log(e.responseText);
            }
        });
    }
</script>
{% endblock %}
